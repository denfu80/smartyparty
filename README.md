
# Sternenhaus: Eine KI-gestützte Wirtschaftssimulation

## Vision

Sternenhaus vereint die Tiefe klassischer Handelssimulationen mit der emergenten Erzählkraft moderner KI-Systeme. Inspiriert von den politischen Intrigen Dunes und dem wirtschaftlichen Scharfsinn der Fugger-Reihe, erschafft das Spiel ein lebendiges Universum, in dem jede Entscheidung Konsequenzen hat und jede Interaktion einzigartig ist.

## Setting & Grundkonzept

Die Menschheit hat die Sterne kolonisiert. Raumstationen ersetzen mittelalterliche Städte, Handelskonvois durchqueren den Raum statt Landstraßen. In diesem Vakuum der Macht haben sich Adelshäuser formiert - nicht durch Geburtsrecht, sondern durch wirtschaftliche Dominanz, militärische Stärke und politischen Einfluss.

Das Spiel ist als rundenbasiertes Online-Multiplayer-Spiel konzipiert - eine Web-App, in der alle Spieler asynchron ihre Runden spielen. Sobald alle Spieler ihre Züge abgeschlossen haben, beginnt die nächste Runde. In einer späteren Ausbaustufe können Timer konfiguriert werden, bis wann alle ihre Runde gespielt haben müssen. Anders als bei traditionellen Wirtschaftssimulationen ist die Welt nicht statisch. Durch den Einsatz von KI-Systemen reagiert das Universum dynamisch auf Spielerentscheidungen, generiert glaubwürdige Charaktere und erschafft emergente Geschichten.

## Die zwei Säulen: Reputation und Einfluss

Im Zentrum des Spiels stehen zwei fundamentale Messwerte, die unabhängig voneinander existieren, sich aber gegenseitig beeinflussen.

**Reputation** repräsentiert das soziale Kapital eines Spielers. Sie entscheidet darüber, ob Türen sich öffnen, ob Verhandlungen gelingen, ob man bei wichtigen Entscheidungen konsultiert wird. Ein Spieler mit hoher Reputation wird respektiert, seine Versprechen werden geglaubt, seine Angebote ernst genommen. Reputation ist jedoch fragil - ein einziger Skandal, eine aufgedeckte Intrige kann sie in den Abgrund stürzen lassen.

**Einfluss** hingegen ist die harte Währung der Macht. Er speist sich aus wirtschaftlicher Dominanz, territorialer Kontrolle, militärischer Stärke, politischen Ämtern, Informationsnetzwerken und technologischem Vorsprung. Einfluss ist stabiler als Reputation, aber auch schwerer zu erlangen. Ein Spieler mit hohem Einfluss kann Märkte manipulieren, Entscheidungen erzwingen, Konkurrenten eliminieren - auch wenn man ihn dafür verachtet.

Die Kunst des Spiels liegt darin, beide Größen auszubalancieren. Ein ehrenhafter Händler mit hoher Reputation aber geringem Einfluss wird respektiert, kann aber wenig bewirken. Ein skrupelloser Waffenbaron mit massivem Einfluss aber schlechter Reputation wird gefürchtet, aber kaum jemand wird ihm freiwillig dienen.

## Der Aufstieg vom Händler zum Großen Haus

Jeder Spieler beginnt als unabhängiger Händler mit einer generierten Hintergrundgeschichte. Die KI erschafft eine glaubwürdige Vergangenheit - vielleicht ein ehemaliger Flottenoffizier mit militärischen Kontakten aber auch Schulden, oder eine Erbin einer verfallenen Handelsdynastie, verzweifelt den Familiennamen wiederherzustellen. Diese Backstory ist nicht nur Flavor-Text, sondern beeinflusst aktiv die Startbedingungen und NPC-Reaktionen.

Mit wachsendem Einfluss erweitert sich der Handlungsspielraum. Wer genügend Stationen kontrolliert, ausreichend Handelsvolumen generiert und sich Reputation bei etablierten Häusern erarbeitet, wird als Minor House anerkannt. Der Aufstieg zum Major House erfordert territoriale Präsenz über mehrere Sektoren, Vasallen oder Schlüsselämter, und eine solide Reputation bei den anderen Großmächten.

## Das Ämtersystem: Privilegien als Spielmechanik

Die Adelshäuser sind keine monolithischen Blöcke, sondern komplexe politische Gebilde mit internen Hierarchien. Jedes Haus vergibt verschiedene Ämter, die konkrete Spielvorteile bieten.

Ein Handelslizenz-Verwalter kann Konkurrenten Zölle auferlegen oder gar Handelsverbote aussprechen. Ein Flottenkommandant kontrolliert militärische Ressourcen und kann Routen sichern - oder für eigene Raubzüge nutzen. Ein Ressourcen-Monopolist genießt Vorkaufsrechte und Preiskontrolle. Der Geheimdienstchef eines Hauses erhält vergünstigten Zugang zu dessen Spionage-Netzwerk.

Die KI vergibt diese Ämter nicht nach Schema, sondern basierend auf aktueller Reputation, erbrachten Leistungen, der politischen Großwetterlage und den Intrigen anderer Spieler. Ein Haus, das sich im Krieg befindet, wird militärische Positionen höher bewerten. Ein wirtschaftlich angeschlagenes Haus könnte Ämter an den Meistbietenden vergeben.

Ämter sind nicht für die Ewigkeit. Sie können entzogen werden - durch Skandale, politische Umschwünge oder erfolgreiche Intrigen von Konkurrenten. Dies schafft permanente Unsicherheit und zwingt Spieler, ihre Positionen aktiv zu verteidigen.

## Information als vierte Dimension

Nicht alles was geschieht, wird von allen gesehen. Das Spiel unterscheidet zwischen öffentlichen, halböffentlichen und geheimen Aktionen.

Normale Handelsgeschäfte sind öffentlich - jeder sieht sie, NPCs und Spieler können darauf reagieren. Große Deals und Allianzen sind halböffentlich - Gerüchte verbreiten sich, aber Details bleiben unklar. Die KI lässt NPCs mit "Ich habe gehört, dass..." reagieren.

Geheime Aktionen wie Bestechung, Sabotage oder Schmuggelrouten bleiben verborgen - es sei denn, sie werden aufgedeckt. Dann folgen Skandale, Reputationsverlust und veränderte NPC-Reaktionen.

## Spionage: KI-Charaktere mit Agenda

Das Spionagesystem ist mehr als ein Mechanik-Layer - es ist ein Netzwerk lebendiger Charaktere. Jeder Spion, den man anheuert, hat eine von der KI generierte Persönlichkeit. Manche sind gierig und lassen sich leicht kaufen. Andere sind idealistisch und werden niemals gegen ihre Prinzipien handeln. Wieder andere sind opportunistisch und dienen dem Höchstbietenden.

Loyalität ist dynamisch und hängt von Bezahlung, Behandlung und persönlichen Werten ab. Ein Spion merkt sich, ob man ihn in selbstmörderische Missionen schickt oder fair behandelt. Konkurrierende Spieler können versuchen, deine Agenten abzuwerben - der Preis hängt von deren aktueller Zuneigung ab, die wiederum mit der Reputation beim jeweiligen Haus verbunden ist.

Die KI generiert Verhandlungsdialoge, die diese Beziehungen reflektieren. Ein loyaler Spion warnt vielleicht vor einem Bestechungsversuch. Ein unzufriedener läuft kommentarlos über. Ein idealistischer verweigert Aufträge, die seinen Werten widersprechen.

Spione haben zudem Hausloyalitäten. Jemand der aus einem bestimmten Adelshaus stammt, wird niemals fundamentale Interessen dieses Hauses verraten - egal wie viel man zahlt. Dies zwingt Spieler, diverse Netzwerke aufzubauen.

## Handel: Mehr als Angebot und Nachfrage

Der Handel selbst wird durch KI transformiert. Statt fixer Preislisten gibt es dynamische Verhandlungen. Ein NPC-Händler erinnert sich an vergangene Geschäfte, berücksichtigt aktuelle Marktlagen und persönliche Beziehungen. Die KI generiert kontextabhängige Antworten - vielleicht bietet jemand einen besseren Preis an, weil man ihm früher geholfen hat, oder er verweigert den Handel ganz, weil man sein Haus verraten hat.

Märkte reagieren auf Spieleraktionen. Massenkäufe treiben Preise hoch. KI-generierte Events erschaffen Krisen und Opportunitäten - eine Seuche lässt Medikamentenpreise explodieren, ein technologischer Durchbruch macht alte Waren wertlos, ein politisches Embargo sperrt profitable Routen.

Spieler können spekulieren, horten, Kartelle bilden und durch gezielte Aktionen Märkte manipulieren. Die KI reagiert darauf mit emergenten Konsequenzen statt vorgefertigten Scripts.

## Die lebendige Welt: Emergente Narration

Das wahre Potenzial der KI-Integration liegt in der emergenten Erzählung. Statt vorgefertigter Quests und Ereignisse generiert das System kontextabhängige Geschichten.

Wenn ein Spieler durch Sabotage eine Konkurrenz-Station schwächt, könnte die KI ein Event generieren, in dem ein kleineres Haus diese Schwäche ausnutzt und einen Übernahmeversuch startet. Oder ein NPC-Kommandant bietet dem Saboteur heimlich eine Allianz an, weil er ebenfalls von der Schwächung profitiert.

NPCs haben keine fixen Dialogbäume, sondern generierte Persönlichkeiten mit eigenen Zielen. Ein Stationskommandant merkt sich alle Interaktionen und entwickelt komplexe Beziehungen zu den Spielern. Er könnte einem Spieler verzeihen, dass er früher gegen sein Haus agiert hat, wenn dieser nun wertvolle Dienste leistet. Oder er trägt einen Groll über Jahrzehnte.

Das Nachrichtensystem spiegelt die tatsächliche Spielsituation wider. Wenn ein Spieler durch aggressive Expansion mächtig wird, kommentieren NPCs dies mit Sorge oder Bewunderung. Wenn geheime Allianzen aufgedeckt werden, verbreiten sich Gerüchte. Die Welt fühlt sich lebendig an, weil sie auf die Taten der Spieler reagiert.

## Fazit: Eine neue Generation der Wirtschaftssimulation

Sternenhaus ist mehr als eine modernisierte Version klassischer Handelsspiele. Durch die Integration von KI-Systemen entsteht ein lebendiges politisches Ökosystem, in dem jede Partie eine einzigartige Geschichte erzählt. Die Mechaniken von Reputation und Einfluss, das tiefe Ämtersystem, die dynamische Spionage und der reaktive Handel erschaffen einen Spielraum voller schwieriger Entscheidungen und unvorhersehbarer Konsequenzen.

Das Spiel belohnt langfristiges Denken, politisches Geschick und die Fähigkeit, Gelegenheiten zu erkennen. Es ist eine Simulation von Macht in all ihren Facetten - wirtschaftlich, politisch, sozial und informationell. Und anders als traditionelle Spiele seiner Art fühlt sich jede Interaktion durch die KI-generierten Charaktere und Events einzigartig und bedeutsam an.

---

## Technical Implementation

### Tech Stack

- **Frontend:** Next.js 16, React 19, TypeScript, Tailwind CSS
- **Backend:** Firebase (Authentication, Firestore, Cloud Functions)
- **AI:** Google Gemini 1.5 Flash
- **UI Components:** shadcn/ui (Radix UI primitives)
- **Deployment:** Firebase Hosting

### Current Features (Sprint 2 - Game Engine Basics)

#### Turn Management System (E-004)

The game implements a round-based gameplay system with the following features:

- **State Machine:** Manages round transitions (`waiting_for_players` → `in_progress` → `round_ending` → `next_round_starting`)
- **Player Ready System:** Players mark themselves as ready to end the current round
- **Automatic Round Processing:** When all players are ready, the system automatically processes the round end
- **Real-time Updates:** Frontend receives live updates via Firestore listeners

**Usage Example:**

```typescript
// Mark player as ready
await markPlayerReady(gameId, playerId);

// Subscribe to round state changes
const unsubscribe = subscribeToRoundState(gameId, (roundState, currentRound) => {
  console.log(`Round ${currentRound}, Phase: ${roundState.currentPhase}`);
});
```

**Components:**
- `useRoundState` hook: Real-time round state management
- `RoundControl` component: UI for round management

#### AI Integration Foundation (E-005)

The game integrates Google Gemini AI for dynamic content generation:

- **NPC Dialog Generation:** AI-powered conversations with NPCs
- **Backstory Generation:** Unique player backstories based on preferences
- **Game Events:** Dynamically generated game events
- **Response Caching:** 24-hour cache for dialog to reduce API costs
- **Rate Limiting:** 10 requests/minute per user
- **Fallback System:** Graceful degradation when AI fails

**Setup:**

1. Get a Gemini API key from https://ai.google.dev/
2. Add to `functions/.env`:
   ```
   GEMINI_API_KEY=your_key_here
   ```
3. Deploy functions: `firebase deploy --only functions`

**Usage Example:**

```typescript
// Generate NPC dialog
const { dialog, cached } = await generateNpcDialog(
  gameId,
  npcId,
  playerId,
  "Player is asking about trade routes"
);

// Generate player backstory
const { backstory, modifiers } = await generateBackstory({
  origin: "military",
  motivation: "revenge"
});
```

#### UI Framework & Components (E-006)

A comprehensive UI component library built with shadcn/ui:

**Layout Components:**
- `GameLayout`: Main layout with navbar and sidebar
- `DashboardLayout`: Simpler layout for lobby screens
- `Navbar`: Top navigation with user menu
- `GameSidebar`: Game navigation and player stats

**Game Components:**
- `ResourceInventory`: Display player resources
- `StationCard`: Show station information
- `RoundControl`: Round management UI

**Responsive Design:**
- Mobile-first approach
- Sidebar becomes drawer on mobile (<768px)
- Grid layouts adapt to screen size

**Usage Example:**

```tsx
import { GameLayout } from '@/components/layout/GameLayout';
import { ResourceInventory } from '@/components/game/ResourceInventory';

export default function GamePage() {
  return (
    <GameLayout gameId="123" playerStats={{ credits: 1000, influence: 50, reputation: 75 }}>
      <ResourceInventory resources={{ fuel: 100, ore: 50, tech: 25 }} />
    </GameLayout>
  );
}
```

### Development Setup

1. **Install dependencies:**
   ```bash
   npm install
   cd functions && npm install
   ```

2. **Configure environment:**
   ```bash
   cp .env.example .env
   # Add your Firebase config and Gemini API key
   ```

3. **Run development server:**
   ```bash
   npm run dev
   ```

4. **Deploy to Firebase:**
   ```bash
   firebase deploy
   ```

### Firestore Data Model

```
/games/{gameId}
  - currentRound: number
  - roundState: {
      currentPhase: string
      playersReady: string[]
      allPlayersReady: boolean
      actionsThisRound: number
    }

  /players/{playerId}
    - isReady: boolean
    - resources: object
    - stats: object

  /actions/{actionId}
    - playerId: string
    - round: number
    - type: string
    - status: 'pending' | 'validated' | 'executed' | 'failed'

  /events/{eventId}
    - type: string
    - description: string
    - effects: object

/ai-cache/{cacheId}
  - prompt: string
  - response: string
  - expiresAt: timestamp
  - hitCount: number
```

### Security Rules

- Users can read/write their own data
- Game players can read/update game state
- Players can create actions in their games
- AI cache is read-only for clients
- Events can only be created by Cloud Functions

See `firestore.rules` for complete security configuration.

---

For more details, see:
- [Sprint Planning](docs/sprints/README.md)
- [Architecture Documentation](docs/architecture/README.md)
- [Development Guide](docs/DEVELOPMENT.md)
